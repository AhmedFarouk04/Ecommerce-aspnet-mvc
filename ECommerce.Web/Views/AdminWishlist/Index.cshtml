@model IEnumerable<ECommerce.Web.ViewModels.WishlistAdminViewModel>

@{
    ViewData["Title"] = "Wishlist Management";
    Layout = "~/Views/Admin/_AdminLayout.cshtml";
}

<div class="container my-5">

    <h2 class="fw-bold mb-4">
        <i class="bi bi-heart-fill text-danger"></i> Wishlist Management
    </h2>

    <form method="get" class="mb-3">
        <div class="input-group">
            <input name="search"
                   value="@ViewBag.Search"
                   class="form-control"
                   placeholder="Search product or user..." />
            <button class="btn btn-primary">
                <i class="bi bi-search"></i>
            </button>
        </div>
    </form>

    <div class="card shadow-sm p-4">

        <div class="table-responsive">
            <table class="table table-hover align-middle">
                <thead class="table-light">
                    <tr>
                        <th>ID</th>
                        <th>User</th>
                        <th>Product</th>
                        <th>Added At</th>
                        <th class="text-end">Actions</th>
                    </tr>
                </thead>

                <tbody>
                    @foreach (var i in Model)
                    {
                        <tr>
                            <td>@i.Id</td>

                            <td>
                                <img src="/images/users/@(i.UserThumbnail ?? "default.png")"
                                     width="40" height="40"
                                     class="rounded-circle"
                                     style="object-fit:cover;">
                                <span class="ms-2 fw-bold">@i.UserName</span>
                            </td>

                            <td>
                                <img src="/images/products/@(i.ProductThumbnail ?? "no-image.png")"
                                     width="55" height="55"
                                     class="rounded"
                                     style="object-fit:cover;">
                                <a class="ms-2 fw-bold"
                                   href="/Products/Details/@i.ProductId">
                                    @i.ProductName
                                </a>
                            </td>

                            <td>@i.AddedAtFormatted</td>

                            <td class="text-end">
                                <button type="button"
                                        class="btn btn-sm btn-outline-danger"
                                        data-bs-toggle="modal"
                                        data-bs-target="#deleteWishlistModal"
                                        data-wishlist-id="@i.Id">
                                    <i class="bi bi-trash"></i> Delete
                                </button>
                            </td>
                        </tr>
                    }
                </tbody>

            </table>
        </div>

        <nav>
            <ul class="pagination justify-content-center mt-3">
                @{
                    int current = ViewBag.CurrentPage;
                    int total = ViewBag.TotalPages;

                    for (int p = 1; p <= total; p++)
                    {
                        <li class="page-item @(p == current ? "active" : "")">
                            <a class="page-link"
                               href="?page=@p&search=@ViewBag.Search">
                                @p
                            </a>
                        </li>
                    }
                }
            </ul>
        </nav>

    </div>
</div>

<div class="modal fade" id="deleteWishlistModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">

            <div class="modal-header">
                <h5 class="modal-title text-danger">
                    <i class="bi bi-exclamation-triangle"></i> Confirm Delete
                </h5>
                <button type="button"
                        class="btn-close"
                        data-bs-dismiss="modal"></button>
            </div>

            <div class="modal-body">
                Are you sure you want to delete this wishlist item?
                <br />
                <small class="text-muted">
                    This action cannot be undone.
                </small>
            </div>

            <div class="modal-footer">
                <button type="button"
                        class="btn btn-secondary"
                        data-bs-dismiss="modal">
                    Cancel
                </button>

                <form method="post"
                      asp-action="Delete"
                      asp-controller="AdminWishlist">
                    @Html.AntiForgeryToken()
                    <input type="hidden" name="id" id="deleteWishlistId" />

                    <button type="submit"
                            class="btn btn-danger">
                        <i class="bi bi-trash"></i> Delete
                    </button>
                </form>
            </div>

        </div>
    </div>
</div>

@section Scripts {
    <script>
        const wishlistModal = document.getElementById('deleteWishlistModal');

        wishlistModal.addEventListener('show.bs.modal', function (event) {
            const button = event.relatedTarget;
            const id = button.getAttribute('data-wishlist-id');
            document.getElementById('deleteWishlistId').value = id;
        });
    </script>
}
